name: Deploy to GitHub Pages

on:
  push:
    branches: [ main ]
  workflow_dispatch:

permissions:
  contents: write

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Show template content
        run: |
          echo "=== Contenido de config.template.js ==="
          cat config.template.js
          echo "======================================"
      
      - name: Generate config.js
        run: |
          echo "Generando config.js..."
          cat config.template.js | sed "s/\${YOUTUBE_API_KEY}/${{ secrets.YOUTUBE_API_KEY }}/g" > config.js
          echo "✅ config.js generado"
      
      - name: Verify config.js was created
        run: |
          echo "=== Verificando config.js ==="
          if [ -f config.js ]; then
            echo "✅ config.js existe"
            echo "Tamaño: $(wc -c < config.js) bytes"
            echo "Contenido:"
            cat config.js
          else
            echo "❌ ERROR: config.js NO existe"
            exit 1
          fi
      
      - name: Prepare files for deployment
        run: |
          echo "=== Preparando archivos ==="
          # Crear directorio temporal para deploy
          mkdir -p deploy_files
          
          # Copiar archivos necesarios
          cp index.html deploy_files/
          cp config.js deploy_files/
          
          # Verificar qué hay en deploy_files
          echo "Archivos en deploy_files:"
          ls -lah deploy_files/
      
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./deploy_files
          publish_branch: gh-pages
          force_orphan: true
